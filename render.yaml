# Render Blueprint for Finance Tracker Full Stack Application
# This file defines the infrastructure for deploying the application on Render
# 
# IMPORTANT: Set sensitive environment variables in Render dashboard, not in this file
# For security, environment variables like MONGODB_URI and REACT_APP_API_BASE_URL
# should be configured in the Render dashboard after service creation

services:
  # Backend Web Service
  - type: web
    name: finance-tracker-backend
    env: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: free  # Change to 'starter' or 'standard' for production
    region: oregon  # Change to your preferred region
    branch: main  # Change to your default branch
    
    # Environment variables (set these in Render dashboard for security)
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      
      # MongoDB Configuration (REQUIRED - set in Render dashboard)
      # IMPORTANT: Before deploying, configure MongoDB Atlas Network Access:
      # 1. Go to MongoDB Atlas → Network Access
      # 2. Add IP Address: 0.0.0.0/0 (or specific Render IPs)
      # 3. Connection string must include: retryWrites=true&w=majority&ssl=true
      # Example: mongodb+srv://user:pass@cluster.mongodb.net/db?retryWrites=true&w=majority&ssl=true
      # - key: MONGODB_URI
      #   value: mongodb+srv://username:password@cluster.mongodb.net/database?retryWrites=true&w=majority&ssl=true
      # - key: MONGODB_DATABASE
      #   value: finance_tracker
      
      # Server Configuration
      - key: SERVER_PORT
        value: 8080
      
      # Optional: Additional configuration
      - key: JAVA_OPTS
        value: -Xmx512m -Xms256m
    
    # Health check configuration
    healthCheckPath: /finance-tracker/actuator/health
    
    # Auto-deploy settings
    autoDeploy: true

  # Frontend Static Site Service
  # Using static site deployment for simpler and faster builds
  # NOTE: Redirects/rewrites for React Router must be configured in Render dashboard:
  # Go to Settings → Redirects/Rewrites → Add: Source: /* → Destination: /index.html (Rewrite)
  - type: static_site
    name: finance-tracker-frontend
    buildCommand: cd frontend-web && npm install && npm run build
    publishPath: frontend-web/build
    plan: free  # Change to 'starter' or 'standard' for production
    region: oregon  # Change to your preferred region (should match backend region)
    branch: main  # Change to your default branch
    
    # Environment variables
    # IMPORTANT: Set REACT_APP_API_BASE_URL in Render dashboard with your backend URL
    # Example: https://finance-tracker-backend.onrender.com/finance-tracker/api/v1
    envVars:
      # Backend API URL (REQUIRED - set in Render dashboard)
      # Replace 'your-backend-service-name' with your actual backend service name
      # Format: https://your-backend-service-name.onrender.com/finance-tracker/api/v1
      # - key: REACT_APP_API_BASE_URL
      #   value: https://finance-tracker-backend.onrender.com/finance-tracker/api/v1
    
    # Auto-deploy settings
    pullRequestPreviewsEnabled: false
    autoDeploy: true

  # Alternative: Frontend Docker Service (if you prefer Docker deployment)
  # Uncomment this section and comment out the static_site section above if you want Docker deployment
  # - type: web
  #   name: finance-tracker-frontend-docker
  #   env: docker
  #   dockerfilePath: ./frontend-web/Dockerfile
  #   dockerContext: ./frontend-web
  #   plan: free
  #   region: oregon
  #   branch: main
  #   envVars:
  #     # - key: REACT_APP_API_BASE_URL
  #     #   value: https://finance-tracker-backend.onrender.com/finance-tracker/api/v1
  #   healthCheckPath: /health
  #   autoDeploy: true

